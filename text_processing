#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2023/5/16 13:50
# @Author  : ykjiang2
# @Email   : ykjiang2@iflytek.com
# @File    : text_processing.py
import re
import json


def data_preprocess(line):
    ## ç‰¹æ®Šæ“ä½œæ–‡æœ¬
    new_line = []
    for char in list(line):
        new_line.append(char)
    new_line = "".join(new_line)
    punct = ' |ã€|ã€‚|;|ï¼›|ï¼Œ|,|:|ï¼š|!|ï¼|\?|ï¼Ÿ|ï¼ƒ|ï¼„|ï¼†|ï¼Š|ï¼»|ï¼½|ï¼¾|ï½›|ï½|ã€Œã€|ã€ã€|ã€ã€‘|ã€–ã€—|ã€˜ã€™|ã€šã€›|ã€°|ã€¾|ã€¿|\'|\\|\"|ğŸˆšï¸|ğŸˆ¶ï¸|ğŸ‘€|ğŸ˜­|ğŸ‘Œ|â•'
    splits = re.split(punct, new_line.strip())
    line = ''.join(splits)
    new_line = line.lower()
    return new_line


def txt2json_text(text):
    '''
    å¤„ç†GPTè¿”å›çš„æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–å’Œæ¸…æ´—å¤„ç†
    :param text:
    :return:
    '''
    text = text.replace('\'', '\"').replace('ï¼š', ':').replace('ï¼Œ', ',')\
        .replace("```", '').replace("- ", '').replace("\n\n", '\n')
    pattern = r'{.*?}' # {[\s\S]*}
    matches = re.findall(pattern, text, re.DOTALL)
    text = matches[0] if matches else ''
    if text=='':
        print('å›å¤ä¸å®Œæˆ')
    # print('dict:', json.loads(text))
    return json.dumps(json.loads(text), indent=4, ensure_ascii=False)
